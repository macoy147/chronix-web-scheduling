<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONIX - Manage Schedules</title>
    <link rel="stylesheet" href="/css/admin-schedules.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="admin-nav">
        <div class="nav-left">
            <img src="/img/img/CTU_new_logo-removebg-preview.png" alt="CTU Logo" class="admin-logo">
            <img src="/img/img/CHRONIX_LOGO.png" alt="CHRONIX Logo" class="admin-logo">
            <span class="admin-app-title">CHRONIX</span>
        </div>
        
        <ul class="nav-links">
            <li><a href="admin-dashboard.html"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
            <li><a href="admin-subjects.html"><i class="bi bi-book"></i> Subjects</a></li>
            <li><a href="admin-sections.html"><i class="bi bi-layers"></i> Sections</a></li>
            <li><a href="admin-rooms.html"><i class="bi bi-door-open"></i> Rooms</a></li>
            <li class="active"><a href="admin-schedules.html"><i class="bi bi-calendar-event"></i> Schedules</a></li>
            <li><a href="admin-students.html"><i class="bi bi-mortarboard"></i> Students</a></li>
            <li><a href="admin-teachers.html"><i class="bi bi-person-badge"></i> Teachers</a></li>
        </ul>
        <div class="nav-right">
            <div class="admin-profile-dropdown">
                <img id="profileAvatar" src="./img/default_admin_avatar.png" alt="Admin Avatar" class="profile-img">
                <span class="profile-name" id="profileName">Admin <i class="bi bi-chevron-down"></i></span>
                <div class="profile-dropdown">
                    <a href="admin-profile.html"><i class="bi bi-person"></i> Profile</a>
                    <a href="#" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="admin-schedules-main">
        <div class="admin-center-container">
            <!-- View Toggle -->
            <div class="view-toggle-container">
                <!-- Year Level Selector -->
                <div class="year-level-selector">
                    <label for="yearLevelSelect">Year Level:</label>
                    <select id="yearLevelSelect" class="year-level-dropdown">
                        <option value="">Select Year Level</option>
                        <option value="1">Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                    </select>
                </div>
                
                <!-- Shift Toggle -->
                <div class="shift-toggle">
                    <button class="shift-btn active" id="dayShiftBtn">
                        <i class="bi bi-sun"></i> Day Classes
                    </button>
                    <button class="shift-btn" id="nightShiftBtn">
                        <i class="bi bi-moon"></i> Night Classes
                    </button>
                </div>
            </div>

            <!-- Create Schedule Button -->
            <div class="create-schedule-container">
                <button class="schedule-create-btn" id="openScheduleModal">
                    <i class="bi bi-plus-circle"></i> Create New Schedule
                </button>
            </div>

            <!-- Calendar Header -->
            <div class="calendar-header">
                <button class="nav-btn" id="prevMonthBtn">
                    <i class="bi bi-chevron-left"></i>
                </button>
                
                <div class="calendar-title">
                    <h2 id="currentMonthYear">September 2024</h2>
                    <span class="current-view" id="currentViewLabel">Teacher Schedules</span>
                </div>
                
                <button class="nav-btn" id="nextMonthBtn">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar-container">
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be populated by JavaScript -->
                </div>
            </div>

            <!-- Subject Assignment Container -->
            <div class="subject-assignment-container" id="subjectAssignmentContainer">
                <!-- Dynamic subject assignments will appear here -->
            </div>
        </div>
    </main>

    <!-- Create/Edit Schedule Modal - COMPACT VERSION -->
    <div id="scheduleModal" class="modal-overlay" style="display:none;">
        <div class="modal-content schedule-modal compact">
            <h3 id="scheduleModalTitle">Create New Schedule</h3>
            
            <!-- Conflict Alert -->
            <div id="conflictAlert" class="conflict-alert" style="display:none;">
                <i class="bi bi-exclamation-triangle"></i>
                <div class="conflict-message">
                    <strong>Schedule Conflict!</strong>
                    <span id="conflictDetails"></span>
                </div>
                <div class="recommendations" id="recommendations">
                    <!-- Recommendations will be populated here -->
                </div>
            </div>

            <form id="scheduleForm">
                <div class="form-grid compact">
                    <div class="form-row compact">
                        <label>Subject *</label>
                        <select name="subject" id="subjectSelect" class="compact-dropdown" required title="Select Subject">
                            <option value="">Select Subject</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    
                    <div class="form-row compact">
                        <label>Teacher *</label>
                        <select name="teacher" id="teacherSelect" class="compact-dropdown" required title="Select Teacher">
                            <option value="">Select Teacher</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    
                    <div class="form-row compact">
                        <label>Section *</label>
                        <select name="section" id="sectionSelect" class="compact-dropdown" required title="Select Section">
                            <option value="">Select Section</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    
                    <div class="form-row compact">
                        <label>Room *</label>
                        <select name="room" id="roomSelect" class="compact-dropdown" required title="Select Room">
                            <option value="">Select Room</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    
                    <div class="form-row compact">
                        <label>Day *</label>
                        <select name="day" id="daySelect" class="compact-input" required>
                            <option value="">Select Day</option>
                            <option value="Monday">Mon</option>
                            <option value="Tuesday">Tue</option>
                            <option value="Wednesday">Wed</option>
                            <option value="Thursday">Thu</option>
                            <option value="Friday">Fri</option>
                            <option value="Saturday">Sat</option>
                        </select>
                    </div>
                    
                    <div class="form-row compact">
                        <label>Start Time *</label>
                        <div class="time-input-group compact">
                            <input type="time" name="startTime" id="startTime" class="compact-input" required>
                            <select name="startPeriod" id="startPeriod" class="compact-input" required>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row compact">
                        <label>End Time *</label>
                        <div class="time-input-group compact">
                            <input type="time" name="endTime" id="endTime" class="compact-input" required>
                            <select name="endPeriod" id="endPeriod" class="compact-input" required>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row full-width">
                        <label>Schedule Type</label>
                        <div class="schedule-type-toggle compact">
                            <label class="type-option">
                                <input type="radio" name="scheduleType" value="lecture" checked>
                                <span>Lecture</span>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="scheduleType" value="lab">
                                <span>Lab</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Subject Hours Info (updated for per section) -->
                <div class="subject-hours-info" id="subjectHoursInfo" style="display:none;">
                    <div class="hours-breakdown">
                        <strong>Hours for this Section:</strong>
                        <span id="lecHours">0/0</span> Lec | 
                        <span id="labHours">0/0</span> Lab |
                        <span id="totalHours">0/0</span> Total
                    </div>
                    <div class="hours-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="hoursProgress"></div>
                        </div>
                        <span class="progress-text" id="progressText">0% scheduled</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="modal-cancel" id="closeScheduleModal">Cancel</button>
                    <button type="submit" class="modal-submit" id="submitScheduleBtn">Create Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Details Modal -->
    <div id="scheduleDetailsModal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width:400px;">
            <h3>Schedule Details</h3>
            <div class="schedule-details" id="scheduleDetails">
                <!-- Populated by JS -->
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-cancel" id="closeDetailsModal">Close</button>
                <button type="button" class="modal-submit" id="editScheduleBtn">Edit</button>
                <button type="button" class="modal-delete" id="deleteScheduleBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Bubble Notification -->
    <div id="scheduleBubbleMessage" class="section-bubble-message"></div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="/js/auth-guard.js"></script>
    <script src="/js/admin-schedules.js"></script>
</body>
</html>
